<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greater Hartford Area Refinance Calculator</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            font-family: Arial, sans-serif;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 {
            color: #1e40af;
            margin: 0;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .subtitle {
            color: #374151;
            font-size: 1.1rem;
            margin-top: 8px;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            background: #f8fafc;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #64748b;
            transition: all 0.3s;
            border-right: 1px solid #e2e8f0;
        }
        .nav-tab:last-child {
            border-right: none;
        }
        .nav-tab.active {
            background: #4285f4;
            color: white;
        }
        .nav-tab:hover:not(.active) {
            background: #e2e8f0;
            color: #374151;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Calculator Layout */
        .calculator-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: start;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #374151;
            font-size: 13px;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        /* Estimated Rate Section */
        .estimated-rate {
            border: 3px solid #4285f4;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 15px;
        }
        .estimated-rate-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #4285f4;
            margin: 8px 0;
        }
        .rate-subtitle {
            color: #4285f4;
            font-weight: bold;
            font-size: 12px;
        }

        /* Savings Cards */
        .savings-card {
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 12px;
        }
        .savings-card.rate { background: #e3f2fd; }
        .savings-card.monthly { background: #e8f5e8; }
        .savings-card.breakeven { background: #fff3e0; }
        .savings-card.payment { background: #f3e5f5; }
        .savings-label {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .savings-value {
            font-size: 1.6rem;
            font-weight: bold;
            margin: 0;
        }
        .savings-card.rate .savings-value { color: #1976d2; }
        .savings-card.monthly .savings-value { color: #388e3c; }
        .savings-card.breakeven .savings-value { color: #f57c00; }
        .savings-card.payment .savings-value { color: #7b1fa2; }
        
        .net-benefit {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }
        .net-benefit-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #388e3c;
        }

        /* Lead Capture */
        .lead-capture {
            background: #4285f4;
            color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .testimonial {
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 12px;
            margin: 15px 0;
            font-style: italic;
            font-size: 14px;
        }
        .cta-button {
            background: white;
            color: #4285f4;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            width: 100%;
        }
        .benefits-list {
            font-size: 13px;
            margin: 12px 0;
        }
        .why-refinance {
            text-align: left;
            margin-top: 20px;
        }
        .why-refinance ul {
            list-style: none;
            padding: 0;
            font-size: 13px;
        }
        .why-refinance li {
            margin: 6px 0;
            padding-left: 15px;
            position: relative;
        }
        .why-refinance li:before {
            content: "â€¢";
            color: white;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* Current Rates */
        .current-rates {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 15px;
        }
        .rate-display {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }
        .rate-type {
            font-weight: bold;
            font-size: 13px;
        }
        .rate-value {
            color: #059669;
            font-weight: bold;
            font-size: 13px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }
        .form-field {
            margin-bottom: 20px;
        }
        .form-field input {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
        }
        .submit-btn {
            background: #4285f4;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }
        .disclosures {
            font-size: 11px;
            color: #6b7280;
            margin-top: 15px;
            line-height: 1.4;
        }

        /* Blog and Glossary */
        .blog-posts, .glossary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .blog-post, .glossary-term {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #4285f4;
        }
        .blog-post h3, .glossary-term h4 {
            color: #1e40af;
            margin-top: 0;
        }
        .glossary-search {
            margin-bottom: 20px;
        }
        .glossary-search input {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
        }

        @media (max-width: 1000px) {
            .calculator-layout {
                grid-template-columns: 1fr 1fr;
            }
            .lead-capture {
                grid-column: 1 / -1;
            }
        }
        @media (max-width: 600px) {
            .calculator-layout {
                grid-template-columns: 1fr;
            }
            .nav-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Connecticut Refinance Calculator</h1>
            <div class="subtitle">Get current market rates and expert refinancing insights</div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('calculator', this)">Calculator</button>
            <button class="nav-tab" onclick="switchTab('blog', this)">Blog</button>
            <button class="nav-tab" onclick="switchTab('glossary', this)">Glossary</button>
        </div>

        <!-- Calculator Tab -->
        <div id="calculator" class="tab-content active">
            <div class="calculator-layout">
                <!-- Loan Details -->
                <div class="card">
                    <h2 style="color: #374151; margin: 0 0 15px 0; font-size: 1.4rem;">Loan Details</h2>
                    
                    <div class="current-rates">
                        <h3 style="margin: 0 0 8px 0; color: #1e40af; font-size: 1rem;">Current Market Rates</h3>
                        <div class="rate-display">
                            <span class="rate-type">30-Year Fixed:</span>
                            <span class="rate-value">7.25%</span>
                        </div>
                        <div class="rate-display">
                            <span class="rate-type">15-Year Fixed:</span>
                            <span class="rate-value">6.75%</span>
                        </div>
                        <div class="rate-display">
                            <span class="rate-type">5/1 ARM:</span>
                            <span class="rate-value">6.50%</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Current Loan Balance</label>
                        <input type="number" id="balance" value="230000" onchange="calculate()">
                    </div>

                    <div class="form-group">
                        <label>Current Rate (%)</label>
                        <input type="number" id="currentRate" value="6.3" step="0.01" onchange="calculate()">
                    </div>

                    <div class="form-group">
                        <label>Current Payment</label>
                        <input type="number" id="payment" value="1800" onchange="calculate()">
                    </div>

                    <div class="estimated-rate">
                        <div class="savings-label">Estimated New Rate</div>
                        <div class="estimated-rate-value" id="newRate">6.000%</div>
                        <div class="rate-subtitle">Current Hartford area rates for your profile</div>
                    </div>

                    <div class="form-group">
                        <label>Loan Term</label>
                        <select id="term" onchange="calculate()">
                            <option value="30">30 Years</option>
                            <option value="15">15 Years</option>
                            <option value="20">20 Years</option>
                            <option value="25">25 Years</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Credit Score</label>
                        <select id="credit" onchange="updateRate()">
                            <option value="740">740-759 (Good)</option>
                            <option value="760">760-799 (Very Good)</option>
                            <option value="800">800+ (Excellent)</option>
                            <option value="700">700-739 (Fair)</option>
                            <option value="650">650-699 (Poor)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Cash Out (Optional)</label>
                        <input type="number" id="cashOut" value="0" onchange="calculate()">
                    </div>

                    <div class="form-group">
                        <label>Estimated Closing Costs</label>
                        <input type="number" id="closingCosts" value="4600" readonly>
                        <small style="color: #666; font-size: 12px;">Auto-calculated: 2% of loan amount</small>
                    </div>
                </div>

                <!-- Savings Analysis -->
                <div class="card">
                    <h2 style="color: #374151; margin: 0 0 15px 0; font-size: 1.4rem;">Your Savings Analysis</h2>
                    
                    <div class="savings-card rate">
                        <div class="savings-label">Your Estimated Rate</div>
                        <div class="savings-value" id="displayRate">6.000%</div>
                    </div>

                    <div class="savings-card monthly">
                        <div class="savings-label">Monthly Savings</div>
                        <div class="savings-value" id="monthlySavings">$421</div>
                    </div>

                    <div class="savings-card breakeven">
                        <div class="savings-label">Break-Even Point</div>
                        <div class="savings-value" id="breakEven">11 months</div>
                    </div>

                    <div class="savings-card payment">
                        <div class="savings-label">New Payment</div>
                        <div class="savings-value" id="newPayment">$1379</div>
                    </div>

                    <div class="net-benefit">
                        <div style="font-size: 14px; font-weight: bold; margin-bottom: 4px;">5-Year Net Benefit:</div>
                        <div class="net-benefit-value" id="netBenefit">$20662</div>
                    </div>
                </div>

                <!-- Lead Capture -->
                <div class="card lead-capture">
                    <h2 style="margin: 0 0 12px 0; font-size: 1.6rem;">Ready to Get Started?</h2>
                    
                    <div class="testimonial">
                        "Got 3 quotes in 24 hours and saved $340/month!" - Sarah M., West Hartford
                    </div>

                    <button class="cta-button" onclick="openModal()">
                        Lock in These Savings<br>
                        <span style="font-size: 13px;">Get personalized quotes from top Connecticut lenders</span>
                    </button>

                    <div class="benefits-list">
                        âœ“ No obligation âœ“ Multiple lenders âœ“ 24-hour response
                    </div>

                    <div class="why-refinance">
                        <h3 style="color: white; font-size: 1.2rem; margin-bottom: 10px;">Why Refinance Now?</h3>
                        <ul>
                            <li>Connecticut rates are competitive</li>
                            <li>Quick break-even period</li>
                            <li>Proven monthly savings</li>
                            <li>Connecticut tax advantages</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Blog Tab -->
        <div id="blog" class="tab-content">
            <div class="blog-posts">
                <div class="blog-post">
                    <h3>Fed Rate Cuts Expected to Continue Through 2024</h3>
                    <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">September 21, 2025</div>
                    <div style="color: #374151; line-height: 1.6;">
                        The Federal Reserve's recent rate adjustments continue to impact mortgage rates across Connecticut. Current trends suggest homeowners may see additional refinancing opportunities as rates stabilize in the mid-6% range for 30-year fixed mortgages.
                    </div>
                </div>
                
                <div class="blog-post">
                    <h3>Connecticut Home Values: Statewide Market Update</h3>
                    <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">September 18, 2025</div>
                    <div style="color: #374151; line-height: 1.6;">
                        Connecticut home values have shown resilience despite national market fluctuations. The median home price statewide has increased 3.2% year-over-year, providing homeowners with additional equity for potential refinancing opportunities across all counties.
                    </div>
                </div>
                
                <div class="blog-post">
                    <h3>When Does Refinancing Make Sense?</h3>
                    <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">September 15, 2025</div>
                    <div style="color: #374151; line-height: 1.6;">
                        The "1% rule" for refinancing isn't always accurate in today's market. Learn about the break-even analysis, closing costs, and other factors that determine whether refinancing will benefit your specific financial situation.
                    </div>
                </div>
                
                <div class="blog-post">
                    <h3>Cash-Out Refinancing vs. Home Equity Loans</h3>
                    <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">September 12, 2025</div>
                    <div style="color: #374151; line-height: 1.6;">
                        With increased home values in Connecticut, many homeowners are exploring ways to access their equity. Compare the advantages and disadvantages of cash-out refinancing versus traditional home equity loans.
                    </div>
                </div>
            </div>
        </div>

        <!-- Glossary Tab -->
        <div id="glossary" class="tab-content">
            <div class="glossary-search">
                <input type="text" placeholder="Search mortgage terms..." onkeyup="searchGlossary(this.value)">
            </div>
            
            <div class="glossary-grid" id="glossaryGrid">
                <div class="glossary-term">
                    <h4>Amortization</h4>
                    <div style="color: #374151; line-height: 1.5; font-size: 14px;">
                        The process of paying off a loan over time through regular payments. Each payment covers both principal and interest, with more going toward interest early in the loan term.
                    </div>
                </div>
                
                <div class="glossary-term">
                    <h4>APR (Annual Percentage Rate)</h4>
                    <div style="color: #374151; line-height: 1.5; font-size: 14px;">
                        The total yearly cost of a loan including interest rate, fees, and other charges expressed as a percentage. APR provides a more complete picture of loan costs than interest rate alone.
                    </div>
                </div>
                
                <div class="glossary-term">
                    <h4>Break-Even Point</h4>
                    <div style="color: #374151; line-height: 1.5; font-size: 14px;">
                        The time it takes for monthly savings from refinancing to equal the closing costs paid. After this point, the refinance provides net savings.
                    </div>
                </div>
                
                <div class="glossary-term">
                    <h4>Cash-Out Refinance</h4>
                    <div style="color: #374151; line-height: 1.5; font-size: 14px;">
                        A refinance where you borrow more than you owe on your current mortgage and take the difference in cash. Uses your home equity for other purposes.
                    </div>
                </div>
                
                <div class="glossary-term">
                    <h4>Closing Costs</h4>
                    <div style="color: #374151; line-height: 1.5; font-size: 14px;">
                        Fees paid when finalizing a mortgage, including appraisal, title insurance, origination fees, and attorney costs. Typically 2-5% of the loan amount.
                    </div>
                </div>
                
                <div class="glossary-term">
                    <h4>Home Equity</h4>
                    <div style="color: #374151; line-height: 1.5; font-size: 14px;">
                        The difference between your home's current market value and the amount you owe on your mortgage. Equity increases as you pay down the loan or as home values rise.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lead Form Modal -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 style="color: #1e40af; margin-bottom: 10px; font-size: 1.8rem;">Get Your Personalized Rate Quotes</h2>
            <p style="color: #6b7280; margin-bottom: 25px;">Based on your <span id="savingsDisplay">$421</span>/month savings calculation.</p>
            
            <form onsubmit="submitForm(event)">
                <div class="form-field">
                    <label style="display: block; margin-bottom: 6px; font-weight: bold; color: #374151;">Full Name *</label>
                    <input type="text" required>
                </div>
                
                <div class="form-field">
                    <label style="display: block; margin-bottom: 6px; font-weight: bold; color: #374151;">Email Address *</label>
                    <input type="email" required>
                </div>
                
                <div class="form-field">
                    <label style="display: block; margin-bottom: 6px; font-weight: bold; color: #374151;">Phone Number *</label>
                    <input type="tel" required>
                </div>
                
                <button type="submit" class="submit-btn">Get Quotes</button>
                
                <div class="disclosures">
                    By submitting this form, you consent to receive marketing communications via phone, email, and SMS from our partner lenders regarding refinancing offers. You may opt out at any time. Message and data rates may apply. Your personal information will be shared with participating lenders to provide you with personalized quotes.
                </div>
            </form>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tabName, element) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            element.classList.add('active');
        }

        // Fetch live rates from multiple sources
        async function fetchLiveRates() {
            try {
                // Try Freddie Mac PMMS API first
                const response = await fetch('https://www.freddiemac.com/pmms-search');
                if (response.ok) {
                    const data = await response.json();
                    updateRatesDisplay(data);
                    return;
                }
            } catch (error) {
                console.log('Freddie Mac API unavailable, trying backup sources...');
            }

            try {
                // Backup: Financial Modeling Prep API (requires free API key)
                // You can get a free key at: https://financialmodelingprep.com/developer/docs
                const apiKey = 'YOUR_API_KEY'; // Replace with your actual API key
                const response = await fetch(`https://financialmodelingprep.com/api/v4/treasury?from=1month&to=30year&apikey=${apiKey}`);
                if (response.ok) {
                    const data = await response.json();
                    // Process treasury data to estimate mortgage rates
                    updateRatesFromTreasury(data);
                    return;
                }
            } catch (error) {
                console.log('Backup API unavailable, using fallback rates...');
            }

            // Fallback to manually curated rates from your rate sheet
            loadFallbackRates();
        }

        function updateRatesDisplay(rateData) {
            // Update rates in the display
            if (rateData.thirtyYear) {
                document.querySelector('.rate-display:nth-child(1) .rate-value').textContent = rateData.thirtyYear + '%';
            }
            if (rateData.fifteenYear) {
                document.querySelector('.rate-display:nth-child(2) .rate-value').textContent = rateData.fifteenYear + '%';
            }
            if (rateData.arm) {
                document.querySelector('.rate-display:nth-child(3) .rate-value').textContent = rateData.arm + '%';
            }
            
            // Update timestamp
            const now = new Date();
            const timeString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            document.querySelector('.current-rates').innerHTML += `<div style="font-size: 11px; color: #6b7280; text-align: center; margin-top: 8px;">Last updated: ${timeString}</div>`;
        }

        function updateRatesFromTreasury(treasuryData) {
            // Convert treasury rates to estimated mortgage rates
            // Typically mortgage rates are 1.5-2.5% above 10-year treasury
            const tenYearRate = treasuryData.find(item => item.month === '10year')?.rate || 4.5;
            
            const estimatedRates = {
                thirtyYear: (tenYearRate + 2.0).toFixed(2),
                fifteenYear: (tenYearRate + 1.5).toFixed(2),
                arm: (tenYearRate + 1.0).toFixed(2)
            };
            
            updateRatesDisplay(estimatedRates);
        }

        function loadFallbackRates() {
            // Load from your rate sheet or default competitive rates
            const fallbackRates = {
                thirtyYear: '7.25',
                fifteenYear: '6.75',
                arm: '6.50'
            };
            
            updateRatesDisplay(fallbackRates);
            
            // Add note about manual rates
            const ratesSection = document.querySelector('.current-rates');
            ratesSection.innerHTML += `<div style="font-size: 10px; color: #f59e0b; text-align: center; margin-top: 5px;">â˜… Competitive Hartford area rates from our lender network</div>`;
        }

        // Load blog posts from CMS
        async function loadBlogPosts() {
            try {
                const response = await fetch('/_posts/');
                if (response.ok) {
                    const posts = await response.json();
                    renderBlogPosts(posts);
                }
            } catch (error) {
                console.log('Using static blog posts');
                // Static posts are already in HTML
            }
        }

        function renderBlogPosts(posts) {
            const blogContainer = document.querySelector('.blog-posts');
            blogContainer.innerHTML = '';
            
            posts.slice(0, 6).forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'blog-post';
                postElement.innerHTML = `
                    <h3>${post.title}</h3>
                    <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">${new Date(post.date).toLocaleDateString()}</div>
                    <div style="color: #374151; line-height: 1.6;">${post.excerpt}</div>
                `;
                blogContainer.appendChild(postElement);
            });
        }

        // Credit score to rate mapping
        function updateRate() {
            const creditScore = parseInt(document.getElementById('credit').value);
            let rate = 7.25; // Base rate
            
            if (creditScore >= 800) rate = 6.0;
            else if (creditScore >= 760) rate = 6.25;
            else if (creditScore >= 740) rate = 6.5;
            else if (creditScore >= 700) rate = 7.0;
            else rate = 7.75;
            
            document.getElementById('newRate').textContent = rate.toFixed(3) + '%';
            document.getElementById('displayRate').textContent = rate.toFixed(3) + '%';
            calculate();
        }

        // Calculate savings
        function calculate() {
            const balance = parseFloat(document.getElementById('balance').value) || 0;
            const currentRate = parseFloat(document.getElementById('currentRate').value) || 0;
            const currentPayment = parseFloat(document.getElementById('payment').value) || 0;
            const cashOut = parseFloat(document.getElementById('cashOut').value) || 0;
            const term = parseInt(document.getElementById('term').value) || 30;
            
            // Auto-calculate closing costs (2% of new loan amount)
            const newLoanAmount = balance + cashOut;
            const closingCosts = newLoanAmount * 0.02;
            document.getElementById('closingCosts').value = Math.round(closingCosts);
            
            // Get new rate from display
            const newRateText = document.getElementById('newRate').textContent;
            const newRate = parseFloat(newRateText.replace('%', '')) || 6.0;
            
            // Calculate new payment
            const monthlyRate = newRate / 100 / 12;
            const numPayments = term * 12;
            let newPayment;
            
            if (monthlyRate === 0) {
                newPayment = newLoanAmount / numPayments;
            } else {
                newPayment = newLoanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                           (Math.pow(1 + monthlyRate, numPayments) - 1);
            }
            
            // Calculate savings
            const monthlySavings = currentPayment - newPayment;
            const breakEvenMonths = monthlySavings > 0 ? Math.ceil(closingCosts / monthlySavings) : 999;
            const fiveYearBenefit = (monthlySavings * 60) - closingCosts;
            
            // Update display
            document.getElementById('newPayment').textContent = '$' + Math.round(newPayment).toLocaleString();
            document.getElementById('monthlySavings').textContent = '$' + Math.round(Math.abs(monthlySavings)).toLocaleString();
            document.getElementById('breakEven').textContent = breakEvenMonths + ' months';
            document.getElementById('netBenefit').textContent = '$' + Math.round(fiveYearBenefit).toLocaleString();
            document.getElementById('savingsDisplay').textContent = '$' + Math.round(Math.abs(monthlySavings)).toLocaleString();
            
            // Color coding for negative savings
            const savingsElement = document.getElementById('monthlySavings');
            if (monthlySavings < 0) {
                savingsElement.style.color = '#dc2626';
            } else {
                savingsElement.style.color = '#388e3c';
            }
        }

        // Modal functions
        function openModal() {
            document.getElementById('leadModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('leadModal').style.display = 'none';
        }

     function submitForm(event) {
    event.preventDefault();
    
    const formData = {
        name: document.getElementById('fullName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        currentBalance: document.getElementById('balance').value,
        currentRate: document.getElementById('currentRate').value,
        creditScore: document.getElementById('credit').value,
        monthlySavings: document.getElementById('monthlySavings').textContent
    };
    
    // Send to Google Sheets
    fetch('https://script.google.com/macros/s/AKfycbwkaecC0l61OQmC4AYy5CvC_gUHzaadOMNjoSL8Y7tLZTjs0j3FtTypz1sOKARzAGDVgA/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    });
    
    alert('Thank you! We\'ll connect you with top Connecticut lenders within 24 hours.');
    closeModal();
}

        // Glossary search
        function searchGlossary(searchTerm) {
            const terms = document.querySelectorAll('.glossary-term');
            terms.forEach(term => {
                const text = term.textContent.toLowerCase();
                if (text.includes(searchTerm.toLowerCase())) {
                    term.style.display = 'block';
                } else {
                    term.style.display = 'none';
                }
            });
        }

        // Initialize on page load
        window.onload = function() {
            updateRate();
            calculate();
            fetchLiveRates(); // Load current market rates
            loadBlogPosts();  // Load blog posts from CMS
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('leadModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
